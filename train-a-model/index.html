
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.3.4">
    
    
      
        <title>Training a classification model - MIDA Video analysis guide</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.db9e7362.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#overview" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="MIDA Video analysis guide" class="md-header__button md-logo" aria-label="MIDA Video analysis guide" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MIDA Video analysis guide
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Training a classification model
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="MIDA Video analysis guide" class="md-nav__button md-logo" aria-label="MIDA Video analysis guide" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    MIDA Video analysis guide
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Using Keras and Tensorflow
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Using Keras and Tensorflow" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Using Keras and Tensorflow
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Training a classification model
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Training a classification model
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#train-a-binary-classifier-from-image-directories" class="md-nav__link">
    Train a binary classifier from image directories
  </a>
  
    <nav class="md-nav" aria-label="Train a binary classifier from image directories">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#image-directory-setup" class="md-nav__link">
    Image directory setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#training-the-binary-classifier" class="md-nav__link">
    Training the binary classifier
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#train-a-multi-label-model-from-images-and-metadata" class="md-nav__link">
    Train a multi-label model from images and metadata
  </a>
  
    <nav class="md-nav" aria-label="Train a multi-label model from images and metadata">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-training-data" class="md-nav__link">
    Create training data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-the-training" class="md-nav__link">
    Run the training
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../evaluate-model/" class="md-nav__link">
        Evaluating a model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../make-predictions/" class="md-nav__link">
        Make predictions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../improve-annotations/" class="md-nav__link">
        Using predictions to improve annotations
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Using YOLOv5
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Using YOLOv5" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Using YOLOv5
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../train-a-yolo-model/" class="md-nav__link">
        Train a YOLOv5 model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../detect-with-yolo-model/" class="md-nav__link">
        Detect symbols with YOLO model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../run-on-alice/" class="md-nav__link">
        Running YOLOv5 on the ALICE HPC
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#train-a-binary-classifier-from-image-directories" class="md-nav__link">
    Train a binary classifier from image directories
  </a>
  
    <nav class="md-nav" aria-label="Train a binary classifier from image directories">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#image-directory-setup" class="md-nav__link">
    Image directory setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#training-the-binary-classifier" class="md-nav__link">
    Training the binary classifier
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#train-a-multi-label-model-from-images-and-metadata" class="md-nav__link">
    Train a multi-label model from images and metadata
  </a>
  
    <nav class="md-nav" aria-label="Train a multi-label model from images and metadata">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-training-data" class="md-nav__link">
    Create training data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-the-training" class="md-nav__link">
    Run the training
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Training a classification model</h1>
                
                <h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>We have worked on various <a href="https://keras.io/">Keras</a>-based models to predict the visibility of
symbols in frames from the TV series.
As these models classify images into <em>showing symbol</em> and <em>not showing symbol</em>,
we call them <em>classification models</em>.
If there is only one symbol of interest, we could put the images with the
symbol in one directory and the images without the symbol in another.
This process is explained in <a href="#train-a-binary-classifier-from-image-directories">Train a binary classifier</a>.</p>
<p>When we want a model to predict the appearance of multiple different symbols,
potentially in the same frame, using directories to separate the classes
becomes intractible.
In that case we have to create a CSV file that contains the filenames of the
images and for each symbol a column that indicates the visibility of the symbol
for each image.
This process is explained in <a href="#train-a-multi-label-model-from-images-and-metadata">Train a multi-label model</a>.</p>
<h2 id="train-a-binary-classifier-from-image-directories">Train a binary classifier from image directories<a class="headerlink" href="#train-a-binary-classifier-from-image-directories" title="Permanent link">&para;</a></h2>
<p>The script <code>build_binary_classifier.py</code> creates a binary classifier from images
in subdirectories of a specific directory.</p>
<h3 id="image-directory-setup">Image directory setup<a class="headerlink" href="#image-directory-setup" title="Permanent link">&para;</a></h3>
<p>Images must go into the directory corresponding to their class.
For example, if your images belong either to <em>class1</em> or <em>class2</em>, you would
use this directory structure:</p>
<ul>
<li><code>images_directory/</code><ul>
<li><code>class1/</code></li>
<li><code>class2/</code></li>
</ul>
</li>
</ul>
<p>If you have lots of images, you can put them in subdirectories under <em>class1</em>
or <em>class2</em>.</p>
<h3 id="training-the-binary-classifier">Training the binary classifier<a class="headerlink" href="#training-the-binary-classifier" title="Permanent link">&para;</a></h3>
<p>The training script takes several required options, as explained in the
command's <code>--help</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>python build_binary_classifier.py --help
<span class="go">Usage: build_binary_classifier.py [OPTIONS]</span>

<span class="go">  Train a binary classifier for images.</span>

<span class="go">  The location of the trained model is based on the --model-basedir and</span>
<span class="go">  --model-name options.</span>

<span class="go">Options:</span>
<span class="go">  -i, --image-dir PATH  Directory with images for training and evaluation</span>
<span class="go">                        [required]</span>
<span class="go">  --model-name TEXT     Name of the model (must not include spaces)</span>
<span class="go">                        [required]</span>
<span class="go">  --model-basedir PATH  Base directory to store all models  [required]</span>
<span class="go">  --epochs INTEGER      [default: 50]</span>
<span class="go">  --seed INTEGER        [default: 42]</span>
<span class="go">  --split FLOAT         [default: 0.2]</span>
<span class="go">  --help                Show this message and exit.</span>
</code></pre></div>

<p>The path to give to <code>--image-dir</code> in the previous example would be the path to
<code>image_directory</code>, relative or absolute.</p>
<h2 id="train-a-multi-label-model-from-images-and-metadata">Train a multi-label model from images and metadata<a class="headerlink" href="#train-a-multi-label-model-from-images-and-metadata" title="Permanent link">&para;</a></h2>
<h3 id="create-training-data">Create training data<a class="headerlink" href="#create-training-data" title="Permanent link">&para;</a></h3>
<p>To train a model, we need images with labels, and a name for the model.
We expect images to be in subdirectories of a given directory.
The filenames and corresponding labels should be in a CSV file.
Filenames must be in a column <code>filename</code> and must be relative to the given
directory.
Names of columns with (numeric 0 or 1) labels must end in <code>_visible</code>.</p>
<p>Minimal example of a labels file:</p>
<table>
<thead>
<tr>
<th>filename</th>
<th>pentagram_visible</th>
<th>star_visible</th>
</tr>
</thead>
<tbody>
<tr>
<td>image001.jpg</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>image002.jpg</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>image003.jpg</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>image004.jpg</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>A model trained on these images and labels will have two outputs: <code>pentagram</code>
and <code>star</code>.</p>
<h3 id="run-the-training">Run the training<a class="headerlink" href="#run-the-training" title="Permanent link">&para;</a></h3>
<p>To train a model, run:</p>
<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>python build_multi_hot_model.py image_dir labels.csv output_model_dir
</code></pre></div>

<p>In this command:</p>
<ul>
<li><code>image_dir</code> is the directory that contains subdirectories with the images;</li>
<li><code>labels.csv</code> is the CSV file holding the filename and label(s) for each image;</li>
<li><code>output_model_dir</code> is the name of the model and the directory that it will
  be saved to.</li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href=".." class="md-footer__link md-footer__link--prev" aria-label="Previous: Overview" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Overview
            </div>
          </div>
        </a>
      
      
        
        <a href="../evaluate-model/" class="md-footer__link md-footer__link--next" aria-label="Next: Evaluating a model" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Evaluating a model
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.8397ff9e.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.1e84347e.min.js"></script>
      
    
  </body>
</html>